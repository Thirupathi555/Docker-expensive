# user www-data;
# worker_processes 4;
# pid /var/run/nginx.pid;

# events {
#   worker_connections 768;
#   # multi_accept on;
# }

# http {

#   ##
#   # Basic Settings
#   ##

#   sendfile on;
#   tcp_nopush on;
#   tcp_nodelay on;
#   keepalive_timeout 65;
#   types_hash_max_size 2048;
#   large_client_header_buffers 6 32k;
#   client_max_body_size 100m;

#   # server_names_hash_bucket_size 64;
#   # server_name_in_redirect off;
#   include /etc/nginx/mime.types;
#   default_type application/octet-stream;

#   ##
#   # Logging Settings
#   ##
#   access_log /var/log/nginx/access.log;
#   error_log /var/log/nginx/error.log debug; # change from debug to warn or error for production

#   ##
#   # Gzip Settings
#   ##
#   gzip on;
#   gzip_disable "msie6";

#   ##
#   # Virtual Host Configs
#   ##

#   include /etc/nginx/conf.d/*.conf;
#   include /etc/nginx/sites-enabled/*;

#   server {
#     listen       80;
#     server_name  localhost;

#     proxy_http_version 1.1;

#     #charset koi8-r;
#     #access_log  /var/log/nginx/host.access.log  main;
#     #error_log /dev/stdout debug;
#     #rewrite_log on;

#     location / {
#         root   /usr/share/nginx/html;
#         index  index.html index.htm;
#         ssi    on;
#     }

#     location /images/ {
#         expires 5s;
#         root   /usr/share/nginx/html;
#         try_files $uri /images/placeholder.png;
#     }

#     #error_page  404              /404.html;

#     # redirect server error pages to the static page /50x.html
#     #
#     error_page   500 502 503 504  /50x.html;
#     location = /50x.html {
#         root   /usr/share/nginx/html;
#     }

#     location /api/ { 
#         # proxy_pass http://localhost:8080/;
#         proxy_pass http://backend:8080/;
#     }

#     }

# }

FROM nginx:mainline-alpine3.20-slim

RUN rm -rf /etc/nginx/nginx.conf && \
    rm -rf /etc/nginx/conf.d/default.conf && \
    mkdir -p /var/cache/nginx/client_temp && \
    mkdir -p /var/cache/nginx/proxy_temp && \
    mkdir -p /var/cache/nginx/fastcgi_temp && \
    mkdir -p /var/cache/nginx/uwsgi_temp && \
    mkdir -p /var/cache/nginx/scgi_temp && \
    chown -R nginx:nginx /var/cache/nginx && \
    chown -R nginx:nginx /etc/nginx/ && \
    chmod -R 755 /etc/nginx/ && \
    chown -R nginx:nginx /var/log/nginx && \
    touch /var/run/nginx.pid && \
    chown -R nginx:nginx /var/run/nginx.pid /run/nginx.pid
COPY nginx.conf /etc/nginx/nginx.conf
COPY code /usr/share/nginx/html
USER nginx
#COPY expense.conf /etc/nginx/conf.d/expense.conf